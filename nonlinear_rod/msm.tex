%Понятие линейной деформации, допущения, понятия и эфекты
%Движение узлов 
%Описать силы в узлах от стержней
%Учет напрвления элементов
\section*{Mass Spring Model}
\subsection*{Linear deformation}
For investigating motion of any mechanical system comes to integration motion equation of
discrete parts of this system. In case of MSM, system described as nodes connected to each other 
by 1D rod elements\ref{fig:nodeExtract}. \eqref{eqn:motionEq}. For this propose need to express all acting forces in
node\eqref{eqn:sumF} for each node in relation to their application place.
\begin{equation}\label{eqn:sumF}
  \vec{F}_n= \vec{F}_{ext} + \sum\vec{F}_{elem}\times[DCM] + \vec{F}_{press}\times[DCM]
\end{equation}\par
$F_{ext}$ is external load force, applied to node in global coordinates. Value of this force for
each time step is loaded from list of loads.\par $F_{press}$ is external pressure and can be
described like force applied to element in local coordinates.\par $F_{elem}$ is sum of internal
forces of each element, which acting in node. From each element counts only half of force to node,
other half going to neighbour node. In case of 1D element system, internal force of each element can
be express like axial force and it is equal to integral of stress over area:
\begin{equation}\label{eqn:Nx}
  N(x)= \int\limits_A \sigma dA
\end{equation}
For 1D rod system $F_{elem}$ can be expressed like:
\cm{Is it has to be divided by 2? in this case how to calc mass of node?}
\begin{equation}\label{eqn:Felem}
  F_{elem} = \sum_{e}N_e(x)/2
\end{equation}\par
The motion of nodes can be expressed by Newton's equation of motion\ref{eqn:motionEq}. As 1D
element was selected as discrete element, only the normal component of the
translational motion is considered, the equation reduces to\par
\begin{equation}\label{eqn:motionEq}
  m\vec{\ddot{x}} + k\vec{x} + c\vec{\dot{x}} = \vec{F_n}
\end{equation}
where $F_n$ is force acting in node $n$, $m$ – mass of node and $\ddot{x}$ is acceleration, $k$ –
stiffness coefficient of node, $x$ is displacement of node and $c$ – damping coefficient of node,
$\dot{x}$ is velosity of node, initial conditions are: $x(0)=0$ and $\dot{x}(0)=V_0$. According to
\ref{eqn:sumF}, $kx$ are described by $\sum{F_{elem}}$, $c\dot{x}$ are described by $F_{press}$ and
motion equantion will become to:
\begin{equation}\label{eqn:motionEqNodeStatic}
  \vec{F}_{press} + \sum{F_{elem}} + m\vec{\ddot{x}} = \vec{F}_n
\end{equation}
where $F_{elem}$ is sum of node's elements forces, $m$ – mass of node and $\ddot{x}$ is
acceleration. In static case $m\ddot{x}$ equal to zero, due zero acceleration, because no external
force is applied and equantion of node is balansed. But if external force are applied, motion will
start, motion equation will become not balansed\ref{eqn:motionEqDynamic}, mass start to act as inertia.
\begin{equation}\label{eqn:motionEqDynamic}
  \vec{F}_{press} + \sum\vec{F}_{elem} + m\vec{\ddot{x}} = F_n + \vec{F}_{ext}
\end{equation}\par
Equations of motion for Euler's scheme of integration can be described like:
\begin{equation}\label{eqn:Accel}
  \vec{\ddot{x}}(t +\Delta t)=\vec{F}_n/m
\end{equation}
\begin{equation}\label{eqn:Velos}
  \vec{\dot{x}}(t +\Delta t)=\vec{\dot{x}}(t)+\vec{\ddot{x}}(t)\Delta t
\end{equation}
\begin{equation}\label{eqn:Displ}
  \vec{x}(t +\Delta t)=\vec{x}(t)+\vec{\dot{x}}(t)\Delta t
\end{equation}
\par Element force becomes from physical deformation of
element. In linear case of study, deformation of element much less compare to
element dimensions. It is expressed by linear geometry
equation\eqref{eqn:linDeformation}, which showing relation between initial
length of element and length in $\Delta t$ state.
\begin{equation}\label{eqn:linDeformation}
  \varepsilon=\frac{dU}{dx}=\frac{l(\Delta t)-l(t)}{l(t)}
\end{equation}
According to Hook law $\sigma=\varepsilon E$ and linear geometry equation
\eqref{eqn:linDeformation}, inner force can be described as:
\begin{equation}\label{eqn:linNxFull}
  N(x)= \int\limits_{Al} \varepsilon EdldA=EA\int\limits_l \varepsilon dl=\frac{EA}{l(t)}*(l(t + \Delta t)-l(t))
\end{equation}
where $l(\Delta t)$ is current length of element, $l(t)$ length of element at previuous time moment,
$E$ – Young’s modulus for element material, $A$ – volume of element. To be able to integrate
equation of motion, need to express deformation in equation \eqref{eqn:linNxFull} by differences
between displacements of nodes, to which element is connected:
\begin{equation}\label{eqn:linNxWdispl}
  N(x)=\frac{EA}{l(t)}*(x_{i}(t)-x_{j}(t))
\end{equation}\par
To words about mechanical properties of valve components, poisson ratio $\nu$ is same, 0.49 for all.
Mean value of chordae length $L ~ 0,025 m$ and diameter $d ~ 0,001 m$. Chordae has density $\rho$
= 1040 kg/m3 and stiffness $E = 2000 N/m$, when leaflets has $\rho$ = 1.06E3 kg/m3 and 
$E = 2 MPa$ (Anterior leaflet), $E = 1 MPa$ (Posterior leaflet)\par
%Нелинейное деформ стержня, по времени
%Описать допущение что модуль упрогости = нелинейность
%\subsection*{Nonlinear deformation}
%Nonlinearity in main mean that element can get huge deformation compare to
%element demesions. Equation of $F_{elem}$ in this case  would change to
%nonlinear form:
%\begin{equation}\label{eqn:nonlinNx}
%  N(x)= \int\limits_t\int\limits_A \sigma dAdt
%\end{equation}
%From this equantion comes that cross sectional area and stiffness coefficient
%will get nonlinearity.
% \par
%Changing of cross sectional area over time for 1D element is changing its length
%over time. Linear geometry equation\eqref{eqn:linDeformation}, showing linear
%relations between length, because difference in $\Delta t$ state takes according
%initial length of element. In case of huge deformation need to recalculate
%length of element on each time step and take difference of displacement
%according to previous time step. In end of geometry equation become to nonlinear
%form:
%\begin{equation}\label{eqn:nonlinDeformation}
%  \varepsilon=\frac{dU}{dx}=\frac{l(\Delta t)-l(t-\Delta t)}{l(\Delta t)}
%\end{equation}
%Inner force\eqref{eqn:linNxFull} also become to nonlinear form:
%\begin{equation}\label{eqn:nonlinNxFull}
%  N(x)= \int\limits_t\int\limits_A \varepsilon EdA=EA\int\limits_t\varepsilon=\frac{EA}{l(\Delta t)}*(l(\Delta t)-l(t-\Delta t))
%\end{equation}
%where $l$ is current length of element, $l_0$ length of element at $t=0$, $E$ –
%Young’s modulus for element material.\par And nonlinear equantion of inner force
%for integration:
%\begin{equation}\label{eqn:nonlinNxWdispl}
%  N(x)=\frac{EA}{l_0}*(U_{i}-U_{j})
%\end{equation}\par

\par
Let's try to describe minimal possible way to get simulation of such structure
as shown on figure \ref{fig:rodSystem}.

\begin{algorithm}\label{algo:calcNodeMovement}
  initialization\;
  \tcp{Preform integration nodes movement over time}
  \tcp{Initial state is $x(0)=\dot{x}(0)=\ddot{x}(0)=0$}
  \tcp{Iterate over time}
  \While{$t < t_{end} - 1$}{
    \tcp{Iterate over nodes}
    \ForEach{node in nodes}
    {
      \tcp{get external force loading}
      $F_{ext}$ = getFext(node, t)\;
      \tcp{push $F_{ext}$ into current node force $F_n$}
      $F_n$ = $F_n + F_{ext}$\;
      \tcp{calc $F_{elm}$ from previous displacement}
      \ForEach{link in neighbours}
      {
        $F_{elm}$ = getFelm(node, link)\;
        \tcp{convert $F_{elm}$ from local to global coordinates}
        $F_{elm}G$ = $F_{elm}\times[DCM]$\;
        \tcp{push $F_{elm}G$ into current node force $F_n$}
        $F_n$ = $F_n + F_{elm}G$\;
      }
      \tcp{calc pressure force}
      $F_{press}$ = getFpress(node, t)\;
      \tcp{convert $F_{elm}$ from local to global coordinates}
      $F_{press}G$ = $F_{press}\times[DCM]$\;
      \tcp{push $F_{elm}G$ into current node force $F_n$}
      $F_n$ = $F_n + F_{press}G$\;
      \tcp{integrate collected $F_n$ to get derivatives of $x$ for $t + \Delta t$}
      $[x(t + \Delta t), \dot{x}(t + \Delta t), \ddot{x}(t+ \Delta t)]$ = integrate($F_n, x(t), \dot{x}(t), \ddot{x}(t)$ )
    }
  }
\end{algorithm}

\newpage